// Generated by CoffeeScript 1.6.1

$(function() {
  var Lesson, handleLessonResult, handlePopcorn, id, lesson, root;
  root = typeof exports !== "undefined" && exports !== null ? exports : this;
  root.pop = null;
  Lesson = Backbone.Model.extend({
    urlRoot: app.url + "/lessons"
  });
  id = window.location.href.substr(-1);
  lesson = new Lesson({
    id: id
  });
  /*
     load all lesson data
  */

  lesson.fetch({
    success: function(data) {
      return handleLessonResult(data.toJSON());
    }
  });
  /*
     handle click chapter
  */

  $('.chapter').click(function(event) {
    var time;
    event.preventDefault();
    time = $(this).data('time');
    return root.pop.jumpTo(time);
  });
  /*
  	  hande result from ajax
  */

  handleLessonResult = function(data) {
    console.log(data);
    return handlePopcorn(data.lesson);
  };
  /*
  	  create popcorn instance
  */

  return handlePopcorn = function(lesson) {
    root.pop = new Pop(lesson.Attachment.url);
    return root.pop.addPopcornElements(lesson.Block);
  };
});
